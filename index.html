<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>J; Compiler</title>
<style>
  body { font-family: monospace; padding: 20px; }
  textarea { width: 100%; height: 200px; }
  #screen { border:1px solid black; padding:10px; margin-top:10px; min-height:50px; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h2>J; Compiler</h2>
<p>Write your J; code below and click "Run J;"</p>

<textarea id="jcode">
# Example J; program
code.j;
x=x
x=5
show console x
show screen "Hello on the screen"

answer=nE/e: 8*9
show screen answer

loop 3-
    show console "Looping!"
    show screen "Screen inside loop"
-

if x>3-
    show console "x is bigger than 3"
-
</textarea>

<br>
<button onclick="runJ()">Run J;</button>

<div id="screen">
<h3>Screen Output:</h3>
</div>
<details>
  <summary>Documentation</summary>
J; syntax
  <br>
To make the ide recognize the code, type, code.j;
  <br>
Putting information on the screen
  <br>
to put text onto the screen type, show screen X
  <br>
Putting information in the console
  <br>
to put text in the console type, show console X
  <br>


Variables
  <br>
this will be really simple because I do not see the point in having different types of variables
  <br>
to make a variable type, x=x
<br>

Loops
  <br>
to make a program repeat itself a set number of times type, loop x-(code, no parentheses needed)-
<br>
to make a program repeat itself a random number of times type, loop random-(code, no parentheses needed)-
<br>
to make a program repeat itself an infinite number of times type, loop infinite-(code, no parentheses needed)-

<br>

Functions
  <br>
to make a function type, make functionName-(parameters if any)- -code-
<br>

Comments
  <br>
to make a comment type, Comment: (your comment, no parentheses needed)-
<br>

Math
  <br>
to do basic operations type, nE/e: x*y=z (for multiplication), nE/e: x/y=z (for division), nE/e: x-y=z (for multiplication), x+y=z (for addition)
  <br>
nE/e stands for numericalExpression/equation
<br>

Conditionals
  <br>
to type a conditional type,
  <br>
if condition-(code if true)-
<br>
if condition-(code if true)-else-(code if false)-
  <br>
</details>
<script>
function runJ() {
    const code = document.getElementById('jcode').value;
    const lines = code.split('\n');
    const screenDiv = document.getElementById('screen');
    screenDiv.innerHTML = '<h3>Screen Output:</h3>'; // clear screen
    let jsCode = '';
    let loopStack = [];
    let indentStack = [];

    for (let line of lines) {
        line = line.trim();

        // Skip empty lines, comments, code.j;
        if (line === '' || line.startsWith('#') || line.startsWith('Comment:') || line === 'code.j;') continue;

        // Variables
        if (/^\w+=/.test(line) && !line.includes('nE/e:')) {
            jsCode += line + ';\n';
            continue;
        }

        // Math nE/e: (with or without assignment)
        if (line.includes('nE/e:')) {
            let parts = line.split('=');
            if (parts.length === 2) {
                let varName = parts[0].trim();
                let expr = parts[1].replace('nE/e:', '').trim();
                jsCode += `${varName} = (${expr});\n`;
            } else {
                let expr = line.replace('nE/e:', '').trim();
                jsCode += `console.log(${expr});\n`;
            }
            continue;
        }

        // Console output
        if (line.startsWith('show console')) {
            let output = line.replace('show console', '').trim();
            jsCode += `console.log(${output});\n`;
            continue;
        }

        // Screen output
        if (line.startsWith('show screen')) {
            let output = line.replace('show screen', '').trim();
            jsCode += `document.getElementById('screen').innerHTML += ${output} + "<br>";\n`;
            continue;
        }

        // Loops: numeric only
        if (line.startsWith('loop ')) {
            let match = line.match(/loop (\d+)-/);
            if (match) {
                let count = match[1];
                jsCode += `for(let i=0;i<${count};i++){\n`;
                loopStack.push('}');
                continue;
            }
        }

        // Conditionals
        if (line.startsWith('if ')) {
            let condition = line.replace('if ', '').replace(/-$/,'').trim();
            jsCode += `if(${condition}){\n`;
            indentStack.push('}');
            continue;
        }

        // Close loop or conditional
        if (line === '-') {
            if (loopStack.length > 0) {
                jsCode += loopStack.pop() + '\n';
            } else if (indentStack.length > 0) {
                jsCode += indentStack.pop() + '\n';
            }
            continue;
        }

        // Unknown lines
        jsCode += '// Unknown line: ' + line + '\n';
    }

    console.log('--- Compiled JS ---');
    console.log(jsCode);
    eval(jsCode); // run the translated JS
}
</script>

</body>
</html>
