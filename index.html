<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>J; Compiler</title>
  <style>
    body {
      font-family: monospace;
      background: #0f0f0f;
      color: #00ff9c;
      padding: 20px;
    }
    textarea {
      width: 100%;
      height: 200px;
      background: #111;
      color: #00ff9c;
      border: 1px solid #00ff9c;
      padding: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px;
      background: #00ff9c;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    #screen {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #00ff9c;
      min-height: 100px;
    }
  </style>
</head>
<body>

<h1>J; Playground</h1>

<textarea id="code">
code.J;
show screen hi
nE/e: 8*9
show screen done
</textarea>

<br>
<button onclick="runJ()">Run J;</button>

<div id="screen"></div>

<script>
function runJ() {
  const input = document.getElementById("code").value.split("\n");
  const screen = document.getElementById("screen");
  screen.innerHTML = "";

  let vars = {};
  let started = false;

  for (let rawLine of input) {
    let line = rawLine.trim();
    if (line === "") continue;

    // Header
    if (!started) {
      if (line === "code.J;") {
        started = true;
        continue;
      } else {
        screen.innerHTML = "❌ Missing code.J; header";
        return;
      }
    }

    // Comment
    if (line.startsWith("Comment:")) continue;

    // show screen
    if (line.startsWith("show screen")) {
      let text = line.replace("show screen", "").trim();
      screen.innerHTML += text + "<br>";
      continue;
    }

    // show console
    if (line.startsWith("show console")) {
      let text = line.replace("show console", "").trim();
      console.log(text);
      continue;
    }

    // Math expression
    if (line.startsWith("nE/e:")) {
      let expr = line.replace("nE/e:", "").trim();
      try {
        let result = eval(expr);
        screen.innerHTML += result + "<br>";
      } catch {
        screen.innerHTML += "❌ Math error<br>";
      }
      continue;
    }

    // Variable assignment
    if (line.includes("=")) {
      let parts = line.split("=");
      let name = parts[0].trim();
      let value = parts[1].trim();

      if (!isNaN(value)) {
        vars[name] = Number(value);
      } else {
        vars[name] = value;
      }
      continue;
    }

    // Unknown command
    screen.innerHTML += "❌ Unknown command: " + line + "<br>";
  }
}
</script>

</body>
</html>
